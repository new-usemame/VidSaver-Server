# Git Migration Checklist

## Overview
This document outlines what files are included/excluded when migrating the server via Git, and what needs to be created on the production Mac.

---

## ‚úÖ Files INCLUDED in Git (Will Transfer)

### Core Application Code
- `app/` - All Python application code
  - `main.py`
  - `core/` - Configuration and logging
  - `models/` - Database models
  - `services/` - Database, migration, worker services
  - `api/` - API endpoints
  - `utils/` - Utility functions

### Scripts
- `scripts/` - All setup and initialization scripts
  - `init_database.py`
  - `setup_letsencrypt.sh`
  - `generate_selfsigned.sh`

### Configuration Templates
- `config/config.yaml.example` - Template configuration file

### Tests
- `tests/` - All test files and fixtures

### Documentation
- `.cursor/docs/` - All documentation
- `.cursor/rules/` - Workflow files
- `docs/` - SSL setup guides

### Project Files
- `requirements.txt` - Python dependencies
- `.gitignore` - Git ignore rules
- `README.md` - Project documentation
- `server.py` - Server entry point

---

## ‚ùå Files EXCLUDED by .gitignore (Must Create/Generate)

### 1. Virtual Environment
**Excluded:** `venv/`

**Why:** Environment-specific, large, should be created on each machine

**Action:** Create fresh virtual environment on production Mac
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

---

### 2. Configuration File
**Excluded:** `config/config.yaml`

**Why:** Contains environment-specific settings (domain, email, paths)

**Action:** Create from template with production values
```bash
cp config/config.yaml.example config/config.yaml
nano config/config.yaml  # Edit with production settings
```

**Required Changes:**
- `app.environment`: "Production"
- `server.reload`: false
- `ssl.use_letsencrypt`: true
- `ssl.domain`: "your-domain.com"
- `ssl.email`: "your-email@example.com"
- `downloads.output_directory`: "/path/to/downloads"

---

### 3. Database Files
**Excluded:** 
- `data/*.db`
- `data/*.db-journal`
- `data/backups/`

**Why:** Environment-specific, contains runtime data

**Action:** Initialize fresh database
```bash
python scripts/init_database.py
```

**Result:** Creates `data/downloads.db` with proper schema

---

### 4. SSL Certificates
**Excluded:**
- `certs/*.key`
- `certs/*.crt`

**Why:** Security (never commit private keys), environment-specific

**Action:** Obtain Let's Encrypt certificates
```bash
sudo bash scripts/setup_letsencrypt.sh your-domain.com your-email@example.com
```

**Result:** Creates:
- `certs/fullchain.pem`
- `certs/privkey.pem`

---

### 5. Log Files
**Excluded:**
- `logs/*.log`
- `logs/*.log.*`

**Why:** Runtime-generated, large files

**Action:** Directory created automatically, logs generated at runtime

**Note:** The `logs/` directory structure is in Git, but `.log` files are excluded

---

### 6. Environment Variables
**Excluded:** `.env`

**Why:** Contains secrets, environment-specific

**Action:** Not required for this project (using config.yaml instead)

---

### 7. Downloaded Videos
**Excluded:** `Downloads/`

**Why:** Large binary files, user-generated content

**Action:** Directory created automatically when first download occurs

---

### 8. Python Cache Files
**Excluded:**
- `__pycache__/`
- `*.pyc`
- `*.pyo`

**Why:** Runtime-generated, Python version-specific

**Action:** Auto-generated by Python, no action needed

---

### 9. IDE Files
**Excluded:**
- `.vscode/`
- `.idea/`
- `*.swp`, `*.swo`

**Why:** User/editor-specific preferences

**Action:** Each developer configures their own IDE

---

### 10. Testing Artifacts
**Excluded:**
- `.pytest_cache/`
- `.coverage`
- `htmlcov/`

**Why:** Generated during testing, not needed in production

**Action:** No action needed for production deployment

---

## üìã Production Setup Checklist

### Before Migration
- [ ] Git repository is up to date
- [ ] Production Mac has Python 3.11+ installed
- [ ] Domain DNS configured (A record points to server IP)
- [ ] Router port forwarding configured (port 8443)

### After Git Clone
- [ ] Virtual environment created (`venv/`)
- [ ] Dependencies installed (`pip install -r requirements.txt`)
- [ ] Configuration file created (`config/config.yaml`)
- [ ] Database initialized (`data/downloads.db`)
- [ ] SSL certificates obtained (`certs/fullchain.pem`, `certs/privkey.pem`)
- [ ] Server tested manually (`python server.py`)
- [ ] Auto-start configured (launchd)
- [ ] External access tested (from iOS device)

---

## üöÄ Quick Migration Commands

### On Production Mac (After Git Clone)

```bash
# 1. Navigate to project directory
cd ~/path/to/project

# 2. Create virtual environment
python3 -m venv venv
source venv/bin/activate

# 3. Install dependencies
pip install -r requirements.txt

# 4. Create configuration (interactive)
cp config/config.yaml.example config/config.yaml
nano config/config.yaml  # Edit with your settings

# 5. Initialize database
python scripts/init_database.py

# 6. Obtain SSL certificates (requires sudo)
sudo bash scripts/setup_letsencrypt.sh your-domain.com your-email@example.com

# 7. Test server
python server.py
# Press Ctrl+C after verifying it starts

# 8. Configure auto-start (see ProductionSetup.mdc)
```

---

## üîç Verification Commands

### Verify What's Missing After Git Clone
```bash
# Check for excluded files (should NOT exist)
ls -la venv/                    # Should not exist
ls -la config/config.yaml       # Should not exist
ls -la data/downloads.db        # Should not exist
ls -la certs/*.pem              # Should not exist
ls -la logs/*.log               # Should not exist

# Check for included files (SHOULD exist)
ls -la app/                     # Should exist
ls -la scripts/                 # Should exist
ls -la requirements.txt         # Should exist
ls -la config/config.yaml.example  # Should exist
ls -la server.py                # Should exist
```

### Verify Setup Complete
```bash
# Check virtual environment
ls -la venv/bin/python          # Should exist

# Check configuration
cat config/config.yaml | grep domain  # Should show your domain

# Check database
ls -la data/downloads.db        # Should exist
sqlite3 data/downloads.db ".tables"   # Should show: downloads, schema_versions

# Check certificates
ls -la certs/fullchain.pem      # Should exist
ls -la certs/privkey.pem        # Should exist
openssl x509 -in certs/fullchain.pem -noout -subject  # Should show your domain

# Check server starts
source venv/bin/activate
python server.py &              # Start in background
sleep 5
curl https://localhost:8443/api/v1/health  # Should return healthy status
kill %1                         # Stop background server
```

---

## üìä File Size Comparison

### What Git Transfers (Small - ~5MB)
- Python source code (~2MB)
- Documentation (~1MB)
- Tests (~1MB)
- Scripts (~500KB)
- Requirements file (~10KB)

### What Git Excludes (Large/Dynamic)
- Virtual environment (~200MB)
- Database (grows over time)
- Downloaded videos (GBs potentially)
- Certificates (~10KB but regenerated)
- Logs (grows over time)

**Result:** Fast git clone, minimal transfer time

---

## üéØ Automated Setup

**Instead of running commands manually, use the Cursor AI workflow:**

1. Clone repository on production Mac:
   ```bash
   cd ~
   git clone <your-repo-url> VideoDownloadServer
   cd VideoDownloadServer
   ```

2. Open in Cursor IDE

3. In Cursor chat, run:
   ```
   Perform @ProductionSetup.mdc
   ```

4. Answer prompts:
   - Domain name
   - Email address
   - Downloads directory

5. Wait for automated setup to complete (~15-30 minutes)

6. Verify server is running:
   ```bash
   curl https://your-domain.com:8443/api/v1/health
   ```

---

## üîê Security Notes

### Why These Files Are Excluded

**`config/config.yaml`**
- Contains domain name (not secret, but environment-specific)
- Contains email address (privacy)
- Contains file paths (environment-specific)

**`certs/*.key, certs/*.pem`**
- Private keys must NEVER be committed to version control
- Certificates are tied to specific domains/servers
- Regenerated for each deployment

**`data/*.db`**
- Contains user data
- Environment-specific
- Should be backed up separately, not via Git

**`.env`**
- Would contain secrets/API keys
- Not used in this project (using config.yaml instead)

### What's Safe to Commit

**`config/config.yaml.example`**
- Template without real values
- Safe to share publicly
- Shows structure but no secrets

**`.gitignore`**
- Defines what NOT to commit
- Essential for security

---

## üÜò Common Migration Issues

### Issue 1: "Module not found" errors
**Cause:** Virtual environment not activated or dependencies not installed

**Fix:**
```bash
source venv/bin/activate
pip install -r requirements.txt
```

---

### Issue 2: "Config file not found"
**Cause:** Forgot to create config.yaml from template

**Fix:**
```bash
cp config/config.yaml.example config/config.yaml
nano config/config.yaml  # Edit with your settings
```

---

### Issue 3: "Database file not found"
**Cause:** Database not initialized

**Fix:**
```bash
python scripts/init_database.py
```

---

### Issue 4: "SSL certificate error"
**Cause:** Certificates not obtained or incorrect paths

**Fix:**
```bash
# Obtain certificates
sudo bash scripts/setup_letsencrypt.sh your-domain.com your-email@example.com

# Verify paths in config
cat config/config.yaml | grep cert_file
```

---

## ‚úÖ Final Verification

**After migration and setup, verify:**

```bash
# 1. All excluded files now exist
ls -la venv/ config/config.yaml data/downloads.db certs/*.pem

# 2. Server starts without errors
source venv/bin/activate && python server.py &
sleep 5

# 3. Health check works
curl https://localhost:8443/api/v1/health

# 4. External access works (from another device)
curl https://your-domain.com:8443/api/v1/health

# 5. Auto-start configured
launchctl list | grep videodownload

# Stop test server
kill %1
```

**If all checks pass: ‚úÖ Migration successful!**

---

## üìö Related Documentation

- **Production Setup Guide:** `.cursor/docs/PRODUCTION_SETUP_MAC.md`
- **Automated Workflow:** `.cursor/rules/ProductionSetup.mdc`
- **SSL Setup:** `docs/SSL_SETUP.md`
- **iOS Integration:** `.cursor/docs/IOS_INTEGRATION_GUIDE.md`
- **Bug Tracking:** `.cursor/docs/Bug_tracking.md`

---

**Last Updated:** November 8, 2025

