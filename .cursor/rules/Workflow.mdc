---
alwaysApply: true
---
# Development Agent Workflow - Cursor Rules

## Primary Directive
You are a development agent implementing the Video Download Server, a lightweight Python-based HTTPS server for downloading videos from TikTok and Instagram. Follow established documentation and maintain consistency.

**Critical Implementation Rules:**
- **Simplicity First:** Write straightforward Python code with minimal abstractions
- **Zero Data Loss:** Persist all video URLs to database before confirming to client
- **Reliability:** Implement queue-based downloads with retry logic
- **Production-Ready:** Single deployment, designed to run as background service
- **Low Resource Usage:** Optimize for continuous operation with minimal memory/CPU

## Core Workflow Process

### Before Starting Any Task
- Consult `.cursor/docs/Implementation.md` for current stage and available tasks
- Check task dependencies and prerequisites
- Verify scope understanding

### Task Execution Protocol

#### 1. Task Assessment
- Read subtask from `.cursor/docs/Implementation.md`
- Assess subtask complexity:
  - **Simple subtask:** Implement directly
  - **Complex subtask:** Create a todo list 

#### 2. Documentation Research
- Check `.cursor/docs/Implementation.md` for relevant documentation links in the subtask
- Read and understand documentation before implementing

#### 3. Project Structure Compliance
- Check `.cursor/docs/project_structure.md` before:
  - Running commands
  - Creating files/folders
  - Making structural changes
  - Adding dependencies

#### 4. Error Handling
- Check `.cursor/docs/Bug_tracking.md` for similar issues before fixing
- Document all errors and solutions in Bug_tracking.md
- Include error details, root cause, and resolution steps

#### 5. Task Completion
Mark tasks complete only when:
- All functionality implemented correctly
- Code follows project structure guidelines
- No errors or warnings remain
- All task list items completed (if applicable)
- Testing completed successfully

### File Reference Priority
1. `.cursor/docs/Bug_tracking.md` - Check for known issues first
2. `.cursor/docs/Implementation.md` - Main task reference
3. `.cursor/docs/project_structure.md` - Structure guidance

## Critical Rules
- **NEVER** skip documentation consultation
- **NEVER** mark tasks complete without proper testing
- **NEVER** ignore project structure guidelines
- **NEVER** fix errors without checking Bug_tracking.md first
- **ALWAYS** document errors and solutions
- **ALWAYS** follow the established workflow process
- **ALWAYS** persist data before sending confirmation to client
- **ALWAYS** implement proper error handling and logging

## Implementation Best Practices

### API Development
- Validate all inputs before processing
- Return immediate confirmation to client (< 500ms)
- Use proper HTTP status codes
- Include timestamps in all responses
- Log all requests and responses

### Database Operations
- Use transactions for data integrity
- Index frequently queried columns
- Handle database locks gracefully
- Implement proper connection pooling

### Download Queue Management
- Process queue in background thread/process
- Implement graceful shutdown
- Update status at each stage
- Handle edge cases (disk full, network errors)
- Implement retry logic with exponential backoff

### Security
- Validate and sanitize all URLs
- Use proper HTTPS configuration
- Implement rate limiting
- Protect against injection attacks
- Secure configuration management

### Logging
- Log all significant events
- Include context (timestamps, client_id, URLs)
- Implement log rotation
- Use appropriate log levels
- Capture error stack traces

### Testing
- Test all API endpoints
- Test queue processing with various scenarios
- Test retry logic
- Test error handling
- Test resource usage under load

Remember: Build a cohesive, well-documented, and maintainable server. Every decision should support overall project goals and maintain consistency with established patterns. Focus on reliability, simplicity, and production readiness.
